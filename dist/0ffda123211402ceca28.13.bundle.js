(window.webpackJsonpwebapp=window.webpackJsonpwebapp||[]).push([[13],{"./src/PdfExport.ts":function(a,t,e){"use strict";e.r(t),e.d(t,"createPDF",function(){return r});var t=e("./node_modules/html2canvas/dist/html2canvas.js"),t=e.n(t),n=e("./node_modules/jspdf/dist/jspdf.es.js");function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function P(){P=function(){return i};var i={},c=Object.prototype,u=c.hasOwnProperty,s=Object.defineProperty||function(t,e,r){t[e]=r.value},t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",p=t.asyncIterator||"@@asyncIterator",h=t.toStringTag||"@@toStringTag";function r(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{r({},"")}catch(t){r=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var o,a,i,c,e=e&&e.prototype instanceof g?e:g,e=Object.create(e.prototype),n=new x(n||[]);return s(e,"_invoke",{value:(o=t,a=r,i=n,c="suspendedStart",function(t,e){if("executing"===c)throw new Error("Generator is already running");if("completed"===c){if("throw"===t)throw e;return L()}for(i.method=t,i.arg=e;;){var r=i.delegate;if(r){r=function t(e,r){var n=r.method,o=e.iterator[n];if(void 0===o)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=void 0,t(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=d(o,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;o=n.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,i);if(r){if(r===l)continue;return r}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===c)throw c="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);c="executing";r=d(o,a,i);if("normal"===r.type){if(c=i.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:i.done}}"throw"===r.type&&(c="completed",i.method="throw",i.arg=r.arg)}})}),e}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}i.wrap=f;var l={};function g(){}function y(){}function e(){}var t={},o=(r(t,n,function(){return this}),Object.getPrototypeOf),o=o&&o(o(S([]))),a=(o&&o!==c&&u.call(o,n)&&(t=o),e.prototype=g.prototype=Object.create(t));function m(t){["next","throw","return"].forEach(function(e){r(t,e,function(t){return this._invoke(e,t)})})}function v(i,c){var e;s(this,"_invoke",{value:function(r,n){function t(){return new c(function(t,e){!function e(t,r,n,o){var a,t=d(i[t],i,r);if("throw"!==t.type)return(r=(a=t.arg).value)&&"object"==k(r)&&u.call(r,"__await")?c.resolve(r.__await).then(function(t){e("next",t,n,o)},function(t){e("throw",t,n,o)}):c.resolve(r).then(function(t){a.value=t,n(a)},function(t){return e("throw",t,n,o)});o(t.arg)}(r,n,t,e)})}return e=e?e.then(t,t):t()}})}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function w(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function S(e){if(e){var r,t=e[n];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return r=-1,(t=function t(){for(;++r<e.length;)if(u.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t}).next=t}return{next:L}}function L(){return{value:void 0,done:!0}}return s(a,"constructor",{value:y.prototype=e,configurable:!0}),s(e,"constructor",{value:y,configurable:!0}),y.displayName=r(e,h,"GeneratorFunction"),i.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,e):(t.__proto__=e,r(t,h,"GeneratorFunction")),t.prototype=Object.create(a),t},i.awrap=function(t){return{__await:t}},m(v.prototype),r(v.prototype,p,function(){return this}),i.AsyncIterator=v,i.async=function(t,e,r,n,o){void 0===o&&(o=Promise);var a=new v(f(t,e,r,n),o);return i.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},m(a),r(a,h,"Generator"),r(a,n,function(){return this}),r(a,"toString",function(){return"[object Generator]"}),i.keys=function(t){var e,r=Object(t),n=[];for(e in r)n.push(e);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in r)return t.value=e,t.done=!1,t}return t.done=!0,t}},i.values=S,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!t)for(var e in this)"t"===e.charAt(0)&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function t(t,e){return a.type="throw",a.arg=r,n.next=t,e&&(n.method="next",n.arg=void 0),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],a=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var i=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(i&&c){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}var a=(o=o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc?null:o)?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r,n,o=this.tryEntries[e];if(o.tryLoc===t)return"throw"===(r=o.completion).type&&(n=r.arg,w(o)),n}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},i}function d(t,e){var r,n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return c(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length)return n&&(t=n),r=0,{s:e=function(){},n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){i=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function u(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function r(t,e){return o.apply(this,arguments)}function o(){var c;return c=P().mark(function t(p,e){var r,h,f;return P().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return h=e||function(t){var r="";return 0<t.metadata.length&&t.metadata.map(function(t){var e;"image"===t.type?r+="<img width='100%' src='"+t.value+"' alt='meta-image' />":"imageheight"===t.type?r+="<img height='780pt' src='"+t.value+"' alt='meta-image' />":"imageheightpad"===t.type?r+="<div style='page-break-before: always'><img height='780pt' src='"+t.value+"' alt='meta-image' /></div>":"imageArray"===t.type&&(e="",t.value.map(function(t){e+="<img width='100%' src='"+t+"' alt='meta-image' />"}),r+=e)}),'<div style="width: 550px; margin: 10px auto; ">'+r+"</div>"}(p)+((null===(r=p.element)||void 0===r?void 0:r.innerHTML)||""),f=new n.jsPDF("portrait","pt","a4"),t.next=4,new Promise(function(t){f.html(h,{callback:t,x:0,y:0,margin:[10,0,30,0],autoPaging:"text"});var e=f.internal.pageSize.getWidth()-30,r=f.internal.pageSize.getHeight()-70,l=r/e,n=!0;if(p.pngs){var o,a=d(p.pngs);try{for(a.s();!(o=a.n()).done;){var i=o.value,c=(n?n=!1:f.addPage(),i.height/i.width),u=0,s=0;l<c?s=(u=r)/c:u=(s=e)*c,f.addImage(i.data,"PNG",15,15,s,u,void 0,"SLOW")}}catch(t){a.e(t)}finally{a.f()}}});case 4:return t.abrupt("return",t.sent);case 5:case"end":return t.stop()}},t)}),(o=function(){var t=this,i=arguments;return new Promise(function(e,r){var n=c.apply(t,i);function o(t){u(n,e,r,o,a,"next",t)}function a(t){u(n,e,r,o,a,"throw",t)}o(void 0)})}).apply(this,arguments)}window.html2canvas=t.a},"./src/share.ts":function(n,t,e){"use strict";e.r(t),e.d(t,"generatePDF",function(){return j}),e.d(t,"generateShareTextFile",function(){return A}),e.d(t,"generateShareText",function(){return T}),e.d(t,"grabWorkspaceSVGs",function(){return U});var t=e("./node_modules/@rm-vca/logger/dist/index.js"),y=e("./src/Blockly/BlocklyAccess.ts"),d=e("./src/platformInfo.ts"),C=e("./src/FileSys/ProjectManager.ts"),c=e("./src/nativeInterface.ts"),F=e("./src/targetPlatform.ts"),D=e("./src/PdfExport.ts"),z=e("./src/AppInfo.ts"),I=e("./src/i18n/i18n.ts"),a=e("./src/texteditor/editor.tsx"),g=e("./src/widget/Modal.tsx"),B=e("./src/SimWindow/SimWindowController.ts"),m=e("./src/FeatureLock/Licenses.ts"),v=e("./src/FeatureLock/LicenseSystem.ts"),W=e("./src/FeatureLock/VRClassSystem.ts"),b=e("./src/index.tsx");function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function G(t,e){var r,n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return u(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Map"===(r="Object"===r&&t.constructor?t.constructor.name:r)||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?u(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length)return n&&(t=n),r=0,{s:e=function(){},n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:e};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,i=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){i=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(i)throw o}}}}function u(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function _(){_=function(){return i};var i={},c=Object.prototype,u=c.hasOwnProperty,s=Object.defineProperty||function(t,e,r){t[e]=r.value},t="function"==typeof Symbol?Symbol:{},n=t.iterator||"@@iterator",p=t.asyncIterator||"@@asyncIterator",h=t.toStringTag||"@@toStringTag";function r(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{r({},"")}catch(t){r=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var o,a,i,c,e=e&&e.prototype instanceof g?e:g,e=Object.create(e.prototype),n=new x(n||[]);return s(e,"_invoke",{value:(o=t,a=r,i=n,c="suspendedStart",function(t,e){if("executing"===c)throw new Error("Generator is already running");if("completed"===c){if("throw"===t)throw e;return L()}for(i.method=t,i.arg=e;;){var r=i.delegate;if(r){r=function t(e,r){var n=r.method,o=e.iterator[n];if(void 0===o)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=void 0,t(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=d(o,e.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;o=n.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,i);if(r){if(r===l)continue;return r}}if("next"===i.method)i.sent=i._sent=i.arg;else if("throw"===i.method){if("suspendedStart"===c)throw c="completed",i.arg;i.dispatchException(i.arg)}else"return"===i.method&&i.abrupt("return",i.arg);c="executing";r=d(o,a,i);if("normal"===r.type){if(c=i.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:i.done}}"throw"===r.type&&(c="completed",i.method="throw",i.arg=r.arg)}})}),e}function d(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}i.wrap=f;var l={};function g(){}function y(){}function e(){}var t={},o=(r(t,n,function(){return this}),Object.getPrototypeOf),o=o&&o(o(S([]))),a=(o&&o!==c&&u.call(o,n)&&(t=o),e.prototype=g.prototype=Object.create(t));function m(t){["next","throw","return"].forEach(function(e){r(t,e,function(t){return this._invoke(e,t)})})}function v(i,c){var e;s(this,"_invoke",{value:function(r,n){function t(){return new c(function(t,e){!function e(t,r,n,o){var a,t=d(i[t],i,r);if("throw"!==t.type)return(r=(a=t.arg).value)&&"object"==k(r)&&u.call(r,"__await")?c.resolve(r.__await).then(function(t){e("next",t,n,o)},function(t){e("throw",t,n,o)}):c.resolve(r).then(function(t){a.value=t,n(a)},function(t){return e("throw",t,n,o)});o(t.arg)}(r,n,t,e)})}return e=e?e.then(t,t):t()}})}function b(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function w(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function x(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(b,this),this.reset(!0)}function S(e){if(e){var r,t=e[n];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return r=-1,(t=function t(){for(;++r<e.length;)if(u.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t}).next=t}return{next:L}}function L(){return{value:void 0,done:!0}}return s(a,"constructor",{value:y.prototype=e,configurable:!0}),s(e,"constructor",{value:y,configurable:!0}),y.displayName=r(e,h,"GeneratorFunction"),i.isGeneratorFunction=function(t){t="function"==typeof t&&t.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},i.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,e):(t.__proto__=e,r(t,h,"GeneratorFunction")),t.prototype=Object.create(a),t},i.awrap=function(t){return{__await:t}},m(v.prototype),r(v.prototype,p,function(){return this}),i.AsyncIterator=v,i.async=function(t,e,r,n,o){void 0===o&&(o=Promise);var a=new v(f(t,e,r,n),o);return i.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},m(a),r(a,h,"Generator"),r(a,n,function(){return this}),r(a,"toString",function(){return"[object Generator]"}),i.keys=function(t){var e,r=Object(t),n=[];for(e in r)n.push(e);return n.reverse(),function t(){for(;n.length;){var e=n.pop();if(e in r)return t.value=e,t.done=!1,t}return t.done=!0,t}},i.values=S,x.prototype={constructor:x,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!t)for(var e in this)"t"===e.charAt(0)&&u.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function t(t,e){return a.type="throw",a.arg=r,n.next=t,e&&(n.method="next",n.arg=void 0),!!e}for(var e=this.tryEntries.length-1;0<=e;--e){var o=this.tryEntries[e],a=o.completion;if("root"===o.tryLoc)return t("end");if(o.tryLoc<=this.prev){var i=u.call(o,"catchLoc"),c=u.call(o,"finallyLoc");if(i&&c){if(this.prev<o.catchLoc)return t(o.catchLoc,!0);if(this.prev<o.finallyLoc)return t(o.finallyLoc)}else if(i){if(this.prev<o.catchLoc)return t(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return t(o.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&u.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}var a=(o=o&&("break"===t||"continue"===t)&&o.tryLoc<=e&&e<=o.finallyLoc?null:o)?o.completion:{};return a.type=t,a.arg=e,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),w(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;0<=e;--e){var r,n,o=this.tryEntries[e];if(o.tryLoc===t)return"throw"===(r=o.completion).type&&(n=r.arg,w(o)),n}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:S(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},i}function s(t,e,r,n,o,a,i){try{var c=t[a](i),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function r(c){return function(){var t=this,i=arguments;return new Promise(function(e,r){var n=c.apply(t,i);function o(t){s(n,e,r,o,a,"next",t)}function a(t){s(n,e,r,o,a,"throw",t)}o(void 0)})}}var M=t.getLogger("share system");function w(){return o.apply(this,arguments)}function o(){return(o=r(_().mark(function t(a,i,e,r){return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(d.PlatformIsNWJS||d.PlatformIsChrome)return a.save(C.projectManager.projectName+".pdf"),t.abrupt("return");t.next=3;break;case 3:if(t.prev=3,d.PlatformIsIOS||d.PlatformIsAndroid)return t.next=7,Object(c.sharePDF)(a.output("datauristring"),i,".pdf");t.next=11;break;case 7:return g.MODALCONTROL.close(),t.abrupt("return");case 11:e=i,r=a.output(),n="application/applicationpdf",o=void 0,(o=document.createElement("a")).setAttribute("href","data:".concat(n,";base64,").concat(btoa(r))),o.setAttribute("download",e),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o);case 12:g.MODALCONTROL.close(),g.MODALCONTROL.showShareDownloadedPrompt(),t.next=19;break;case 16:t.prev=16,t.t0=t.catch(3),g.MODALCONTROL.showShareDownloadFailedPrompt();case 19:case"end":return t.stop()}var e,r,n,o},t,null,[[3,16]])}))).apply(this,arguments)}function x(){return i.apply(this,arguments)}function i(){return(i=r(_().mark(function t(e,r,n,o){var a,i,c,u;return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return M.info("dropboxFileUpload",r),(a=new Headers).append("Content-Type","text/plain; charset=dropbox-cors-hack"),a.append("Authorization","Bearer ".concat(e)),a={method:"POST",headers:a,body:n,redirect:"follow"},i="/".concat(o,"/").concat(r).replace("//","/"),u={autorename:!0,mode:"add",mute:!1,path:i,strict_conflict:!1},t.next=9,fetch("https://content.dropboxapi.com/2/files/upload?arg=".concat(JSON.stringify(u)),a);case 9:if((c=t.sent).ok){t.next=12;break}throw new Error("upload response not ok.");case 12:return t.next=14,c.text();case 14:u=t.sent,M.debug("upload to",i,u);case 16:case"end":return t.stop()}},t)}))).apply(this,arguments)}function S(){return l.apply(this,arguments)}function l(){return(l=r(_().mark(function t(e,r,n,l,o){var a,i,c,u,s;return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return M.info("googleDriveFileUpload",r),(a=new Headers).append("Authorization","Bearer ".concat(e)),c={name:r,mimeType:o,parents:[l]},c=new Blob([JSON.stringify(c)],{type:"application/json"}),s=n instanceof Blob?n:new Blob([n],{type:o}),(i=new FormData).append("",c,"metadata.json"),i.append("",s,r),c={method:"POST",headers:a,body:i,redirect:"follow"},t.next=12,fetch("https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart",c);case 12:if((u=t.sent).ok){t.next=15;break}throw new Error("upload response not ok.");case 15:return t.next=17,u.text();case 17:s=t.sent,M.debug("upload",r,s);case 19:case"end":return t.stop()}},t)}))).apply(this,arguments)}function R(){return(R=r(_().mark(function t(p,h,e){var f,r,n,o,a,i,c,u,s,l=arguments;return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(f=3<l.length&&void 0!==l[3]&&l[3],M.info("uploadShareData"),null!==(n=C.projectManager.currentProject)&&void 0!==n&&n.getFileContentString){t.next=5;break}return g.MODALCONTROL.showShareUploadFailedPrompt(),t.abrupt("return");case 5:if(r=C.projectManager.currentProject.getFileContentString(),n="".concat(p," - ").concat(h).trim(),a=(n="-"===n?"":n)||p||C.projectManager.projectName,M.warn("baseFilename:",a),o="".concat(a,".pdf"),a="".concat(a,".").concat(C.projectManager.fileSystem.getSaveProjectExtension()),f)return M.debug("using local download due to force local param"),t.next=16,w(e,o,r,a);t.next=17;break;case 16:return t.abrupt("return");case 17:if((i=v.getLicenseWithoutRefresh())===m.FeatureLockLicense.Standard||i===m.FeatureLockLicense.VirtualSkillsIQ||i===m.FeatureLockLicense.VirtualSkillsV5)return M.debug("using local download due to no VR class"),t.next=22,w(e,o,r,a);t.next=23;break;case 22:return t.abrupt("return");case 23:return t.next=25,W.classSystem.getDeliveryInfo();case 25:if(c=t.sent,u=c.accessToken,s=c.destination,t.prev=28,"Dropbox"===c.deliveryMethod)return t.next=32,x(u,o,e.output("blob"),s);t.next=38;break;case 32:return t.next=34,x(u,a,r,s);case 34:return g.MODALCONTROL.showShareUploadedPrompt(),t.abrupt("return");case 38:if("Google Drive"===c.deliveryMethod)return t.next=41,S(u,o,e.output("blob"),s,"application/pdf");t.next=47;break;case 41:return t.next=43,S(u,a,r,s,"text/plain");case 43:return g.MODALCONTROL.showShareUploadedPrompt(),t.abrupt("return");case 47:if("email"===c.deliveryMethod)return M.warn("email deliver is not yet supported"),t.next=51,w(e,o,r,a);t.next=54;break;case 51:return t.abrupt("return");case 54:if("Local Download"===c.deliveryMethod)return t.next=57,w(e,o,r,a);t.next=60;break;case 57:return t.abrupt("return");case 60:return M.warn("found unexpected delivery method",c.deliveryMethod),t.next=63,w(e,o,r,a);case 63:return t.abrupt("return");case 64:t.next=70;break;case 66:t.prev=66,t.t0=t.catch(28),M.error(t.t0),g.MODALCONTROL.showShareUploadFailedPrompt();case 70:case"end":return t.stop()}},t,null,[[28,66]])}))).apply(this,arguments)}function L(t,e,r,n,o){o=o||r,M.debug("block bbox: ",r),M.debug("notes bbox: ",o);var a=(r.x<o.x?r:o).x,i=(r.y<o.y?r:o).y,c=r.x+r.width,r=r.y+r.height,u=o.x+o.width,o=o.y+o.height,c={x:a,y:i,width:Math.ceil(100*(u<c?c:u))/100-a,height:Math.ceil(100*(o<r?r:o))/100-i},u=(M.debug("used bbox: ",c),(new XMLSerializer).serializeToString(e)),a=n?(new XMLSerializer).serializeToString(n):"",r=['version="1.1"','xmlns="http://www.w3.org/2000/svg"','xmlns:xlink="http://www.w3.org/1999/xlink"','width="'.concat(c.width,'"'),'height="'.concat(c.height,'"'),'viewBox="'.concat(c.x," ").concat(c.y," ").concat(c.width," ").concat(c.height,'"')].join(" "),o='<rect x="'.concat(c.x-10,'" y="').concat(c.y-10,'" width="').concat(c.width+20,'" height="').concat(c.height+20,'" fill="white" />'),i="<svg ".concat(r,">").concat(o).concat(t,"<g>").concat(u).concat(a,"</g></svg>"),e=(d.isSafari&&!F.targetIsPlaygrounds&&(i=i.replace(/&nbsp;/g," ")),{width:c.width,height:c.height,xml:i});return M.debug("SVG:",e.xml),e}function U(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:y.Blockly.mainWorkspace,r=[],n=e.getTopComments(!0),o=0;o<n.length;o++){var s=n[o];s.textarea_.innerText=s.content_}for(var a,i=e.svgBlockCanvas_,l=e.svgBubbleCanvas_,c=b.BlocklyController.getCurrentMainController().blocklyWorkspace.getTheme().name,p=(t=t,t=Array.from(t.getElementsByTagName("style")),a=new XMLSerializer,t=t.filter(function(t){return a.serializeToString(t).includes(".blockly")}),M.warn("found",t.length,"blockly style elements"),t.map(function(t){t=t.cloneNode(!0);return d.isSafari&&!F.targetIsPlaygrounds&&(d.OSisiOS||(t.textContent=t.textContent.replace(/>/g,"&gt;").replace(/</g,"&lt;"))),a.serializeToString(t)}).join("\n").replace(new RegExp("\\.Zelos-renderer\\.".concat(c,"-theme"),"g"),"")),t=i.cloneNode(!0),c=(t.removeAttribute("width"),t.removeAttribute("height"),t.removeAttribute("transform"),l.cloneNode(!0)),h=(c.removeAttribute("width"),c.removeAttribute("height"),c.removeAttribute("transform"),r.push(L(p,t,i.getBBox(),c,l.getBBox())),e.getTopBlocks(!0)),u=0;u<h.length;u++){var f=h[u];r.push(function(t,e,r){if(1!==(t=Array.from(t.getElementsByTagName("g")).filter(function(t){return t.getAttribute("data-id")===e})).length)return M.error("unexpected number of groups when looking for stack group",t),null;var n=(t=t[0]).cloneNode(!0);return n.removeAttribute("width"),n.removeAttribute("height"),n.removeAttribute("transform"),L(r,n,t.getBBox())}(i,f.id,p))}return r}M.setLevel(M.levels.WARN);var p=1550,h=1140,f=p/h;function J(){return P.apply(this,arguments)}function P(){return(P=r(_().mark(function t(u){return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(e,a){var r=document.createElement("canvas"),n=u.width+1,o=u.height+1,t=o/n,i=(f<t?n=(o=p)/t:o=(n=h)*t,r.setAttribute("width",n+"px"),r.setAttribute("height",o+"px"),M.debug("canvas: ",r),r.getContext("2d")),c=new Image;c.onload=function(){M.debug("image loaded"),i.drawImage(c,0,0,n,o);var t=r.toDataURL("image/png");e({data:t,width:n,height:o})},c.onerror=function(t,e,r,n,o){M.error("img error: ",o),M.debug("img source: ",e),M.debug("img event: ",t),a(o)},c.src="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(u.xml))),M.debug("img.src set")}));case 1:case"end":return t.stop()}},t)}))).apply(this,arguments)}function O(t,e){var r=document.createElement("a"),e="data:text/plain;base64,"+btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,function(t,e){return String.fromCharCode(parseInt(e,16))}));r.setAttribute("href",e),r.setAttribute("download",t),r.style.display="none",document.body.appendChild(r),r.click(),document.body.removeChild(r)}function j(t,e){return E.apply(this,arguments)}function E(){return(E=r(_().mark(function t(g,a){var y,m,i,v,b,w,c,x,h,S,f,d,u,L,k,P,s,O,j,E,A,l,N,T,p=arguments;return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return P=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:20,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:12,n=e+h.getTextDimensions(t,{maxWidth:f-40,fontSize:r}).h;L(n),h.setFontSize(r),h.text(t,20,d+e,{maxWidth:f-40}),d+=n},k=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.5,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:20,n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:10,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:10;try{var a=h.getImageProperties(t),i=a.width*e,i=-1===e?480:i,c=a.height*e,c=-1===e?270:c,l=a.fileType,u=!!(n&&0<n.length&&"null"!==n),p=r+c+o+(u?h.getTextDimensions(n,{align:"center",maxWidth:f-40,fontSize:s}):{h:0,w:0}).h;L(p+=u?o:0),h.addImage(t,l,(f-i)/2,d+r,i,c,void 0,"SLOW"),u&&(h.setFontSize(s),h.text(n,f/2,d+r+c+o,{align:"center",maxWidth:f-40})),d+=p}catch(t){M.debug("JSPDF: Failed to get the image from the URL")}},L=function(t){u<1?(h.addPage(),u++):S-30<d+t&&(h.addPage(),u++,d=0)},y=2<p.length&&void 0!==p[2]&&p[2],m=3<p.length&&void 0!==p[3]&&p[3],t.next=7,B.simWindowController.getUnityScreenshot();case 7:if(i=t.sent,e=a,n=r=void 0,(o=[]).push({property:I.i18n.t("Student Name"),type:"string",value:"".concat(e.name)}),F.targetIsPlaygrounds&&(n=W.classSystem.getClassName(),r=W.classSystem.getClassCode(),n&&r&&o.push({property:I.i18n.t("Class"),type:"string",value:"".concat(n," (").concat(r,")")})),o.push({property:I.i18n.t("Assignment"),type:"string",value:"".concat(e.assignment)}),o.push({property:I.i18n.t("Notes"),type:"string",value:"".concat(e.notes)}),!F.targetIsPlaygrounds||"default"!==(n=B.simWindowController.getSceneName())&&o.push({property:I.i18n.t("Playground"),type:"string",value:I.i18n.t("Playground ".concat(n))}),o.push({property:I.i18n.t("Project Name"),type:"string",value:C.projectManager.projectName}),o.push({property:I.i18n.t("Project Type"),type:"string",value:function(){var t=z.appState.getAppState();if("Blocks"===t.mode)return I.i18n.t("Blocks");switch(t.lang){case"python":return I.i18n.t("Python");case"cpp":return I.i18n.t("C++");default:return t.lang}}()}),o.push({property:I.i18n.t("Date"),type:"string",value:(new Date).toDateString()}),v=o,b=[],y){t.next=40;break}if(2===(w=U(g)).length)return t.t0=b,t.next=16,J(w[0]);t.next=20;break;case 16:t.t1=t.sent,t.t0.push.call(t.t0,t.t1),t.next=40;break;case 20:c=G(w),t.prev=21,c.s();case 23:if((x=c.n()).done){t.next=32;break}return x=x.value,t.t2=b,t.next=28,J(x);case 28:t.t3=t.sent,t.t2.push.call(t.t2,t.t3);case 30:t.next=23;break;case 32:t.next=37;break;case 34:t.prev=34,t.t4=t.catch(21),c.e(t.t4);case 37:return t.prev=37,c.f(),t.finish(37);case 40:if(y){t.next=46;break}return t.next=43,Object(D.createPDF)({type:"html",metadata:v,pngs:b});case 43:h=t.sent,t.next=49;break;case 46:return t.next=48,Object(D.createPDF)({type:"html",metadata:v},g);case 48:h=t.sent;case 49:S=h.internal.pageSize.getHeight(),f=h.internal.pageSize.getWidth(),k((u=d=0,r="../static/img/icons/vex_logos/",F.targetIs123?r+="logo-vex-123.png":F.targetIsGO?r+="logo-vex-go.png":F.targetIsEXP?r+="logo-vex-exp.png":F.targetIsIQ?r+="logo-vex-iq.png":F.targetIsV5?r+="logo-vex-v5.png":F.targetIsPlaygrounds?r+="logo-vexcode-vr.png":r+="logo-vex-robotics.png",r),.3),P("  ",20),s=G(v);try{for(s.s();!(O=s.n()).done;)"string"===(j=O.value).type&&P(j.property+": "+j.value)}catch(t){s.e(t)}finally{s.f()}for(i&&1<i.length?k(i,-1,25):F.targetIsPlaygrounds&&k("../static/img/icons/vex_logos/NoPlaygroundRuns.png",-1,25),E=h.internal.getNumberOfPages(),A=u;0<A;A--)h.movePage(E,1);for(l=1;l<=E;l++)h.setPage(l),h.setFontSize(10),N=a.name&&1<a.name.length?a.name+" - ":"",T=a.assignment&&1<a.assignment.length?a.assignment+" - ":"",N="".concat(N).concat(T),T=N+"Page "+String(l)+" of "+String(E),h.text(T,f/2,S-20,null,null,"center");return t.next=63,function(){return R.apply(this,arguments)}(a.name,a.assignment,h,m);case 63:case"end":return t.stop()}var e,r,n,o},t,null,[[21,34,37,40]])}))).apply(this,arguments)}function A(){return N.apply(this,arguments)}function N(){return(N=r(_().mark(function t(){var e,r;return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r=C.projectManager.currentProject,e=r.getShareFileContentString(),r=r.getShareFileExtension(),t.t0=d.currentPlatform,t.next=t.t0===d.Platform.NWJSWindows||t.t0===d.Platform.NWJSmacOS?6:t.t0===d.Platform.ChromeOS?7:t.t0===d.Platform.iOS?8:t.t0===d.Platform.Android?9:10;break;case 6:case 7:case 8:case 9:return t.abrupt("break",11);case 10:O(C.projectManager.projectName+r,e);case 11:case"end":return t.stop()}},t)}))).apply(this,arguments)}function T(){return V.apply(this,arguments)}function V(){return(V=r(_().mark(function t(){var r,n,e,o;return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e=function(t){var e=999<(n+=1)?"":99<n?"&nbsp;":9<n?"&nbsp;&nbsp;":"&nbsp;&nbsp;&nbsp;";return"<div>"===t?"".concat(r,'<span style="font-size: 11px">').concat(n,"</span>").concat(e,"   "):"<br>"===t?"".concat(r,'<span style="font-size: 11px">').concat(n,"</span>   </div>"):""},o=a.monacoEditor.getHTMLToCopy(),o=o.replace(/<div(.*?)white-space:.pre;">/gi,'<div class="root">'),r='<div style="margin: 0px 0px 0px 5px">',n=0,function(){switch(I.i18n.language){case"ar":return;case"ja":return;case"ko":return;case"th":return;case"zh-CN":return;case"zh-TW":return;default:;}}(),o=o.replace(/<div>|<br>/g,e),t.abrupt("return",'<html>\n  <head>\n      <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">\n  </head>\n  <body>\n  <style>\n  .root {\n      width: 530px;\n      word-break: break-all;\n      color: #000000;\n      background-color: #ffffff;\n      font-size: 10px;\n      line-height: 14px;\n      font-family: \'Courier New\', monospace;\n      white-space: break-spaces;\n      text-indent: -15px;\n      margin: 0px 0px 0px 15px;\n  }\n  </style>'+o+"</body></html>");case 12:case"end":return t.stop()}},t)}))).apply(this,arguments)}}}]);