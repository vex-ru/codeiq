(window.webpackJsonpwebapp=window.webpackJsonpwebapp||[]).push([[54],{"./src/HardwareInterface/IQEXPV5/IQ/IQVexSerial.ts":function(t,r,e){"use strict";e.r(r),e.d(r,"IQVexSerial",function(){return a});var r=e("./node_modules/@rm-vca/logger/dist/index.js"),m=e("./src/HardwareInterface/types/HWEnums.ts"),O=e("./src/HardwareInterface/types/HWErrors.ts"),n=e("./src/HardwareInterface/IQEXPV5/IQ/IQInterface.ts"),S=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/index.ts"),D=e("./src/HardwareInterface/VexVersion.ts"),L=e("./src/GlobalEventSystem.ts"),C=e("./src/widget/Modal.tsx"),V=e("./src/AppInfo.ts"),x=e("./src/i18n/i18n.ts"),_=e("./src/dispatcher.ts"),E=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/errors.ts"),N=e("./src/targetPlatform.ts"),T=e("./src/helpers.ts"),W=e("./src/HardwareInterface/IQEXPV5/VexSerialDevices/VexSerialDevice.ts");function F(e){return(F="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function I(){I=function(){return a};var a={},c=Object.prototype,s=c.hasOwnProperty,u=Object.defineProperty||function(e,t,r){e[t]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",p=e.asyncIterator||"@@asyncIterator",f=e.toStringTag||"@@toStringTag";function r(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,r){return e[t]=r}}function d(e,t,r,n){var o,i,a,c,t=t&&t.prototype instanceof v?t:v,t=Object.create(t.prototype),n=new S(n||[]);return u(t,"_invoke",{value:(o=e,i=r,a=n,c="suspendedStart",function(e,t){if("executing"===c)throw new Error("Generator is already running");if("completed"===c){if("throw"===e)throw t;return x()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,o=t.iterator[n];if(void 0===o)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=h(o,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,a);if(r){if(r===l)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===c)throw c="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);c="executing";r=h(o,i,a);if("normal"===r.type){if(c=a.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(c="completed",a.method="throw",a.arg=r.arg)}})}),t}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=d;var l={};function v(){}function y(){}function t(){}var e={},o=(r(e,n,function(){return this}),Object.getPrototypeOf),o=o&&o(o(C([]))),i=(o&&o!==c&&s.call(o,n)&&(e=o),t.prototype=v.prototype=Object.create(e));function g(e){["next","throw","return"].forEach(function(t){r(e,t,function(e){return this._invoke(t,e)})})}function b(a,c){var t;u(this,"_invoke",{value:function(r,n){function e(){return new c(function(e,t){!function t(e,r,n,o){var i,e=h(a[e],a,r);if("throw"!==e.type)return(r=(i=e.arg).value)&&"object"==F(r)&&s.call(r,"__await")?c.resolve(r.__await).then(function(e){t("next",e,n,o)},function(e){t("throw",e,n,o)}):c.resolve(r).then(function(e){i.value=e,n(i)},function(e){return t("throw",e,n,o)});o(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function m(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function C(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(s.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:x}}function x(){return{value:void 0,done:!0}}return u(i,"constructor",{value:y.prototype=t,configurable:!0}),u(t,"constructor",{value:y,configurable:!0}),y.displayName=r(t,f,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===y||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,t):(e.__proto__=t,r(e,f,"GeneratorFunction")),e.prototype=Object.create(i),e},a.awrap=function(e){return{__await:e}},g(b.prototype),r(b.prototype,p,function(){return this}),a.AsyncIterator=b,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new b(d(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},g(i),r(i,f,"Generator"),r(i,n,function(){return this}),r(i,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=C,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(m),!e)for(var t in this)"t"===t.charAt(0)&&s.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=s.call(o,"catchLoc"),c=s.call(o,"finallyLoc");if(a&&c){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&s.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}var i=(o=o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc?null:o)?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),m(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,o=this.tryEntries[t];if(o.tryLoc===e)return"throw"===(r=o.completion).type&&(n=r.arg,m(o)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:C(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function s(e,t,r,n,o,i,a){try{var c=e[i](a),s=c.value}catch(e){return void r(e)}c.done?t(s):Promise.resolve(s).then(n,o)}function U(c){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=c.apply(e,a);function o(e){s(n,t,r,o,i,"next",e)}function i(e){s(n,t,r,o,i,"throw",e)}o(void 0)})}}function B(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,i(n.key),n)}}function j(e,t){return(j=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function Q(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=o(r),t=(e=n?(e=o(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===F(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return k(t)}}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function X(e,t,r){return(t=i(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e){e=function(e,t){if("object"!==F(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!==F(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===F(e)?e:String(e)}var P=r.getLogger("IQVexSerial"),a=(P.setLevel(P.levels.WARN),P.setHistoryLogger("HWInterface"),function(e){var t=u;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&j(t,e);var r,n,o,i,a,c,s,l,p,f,d,h,v,y,g,b,w=Q(u);function u(){var t;if(!(this instanceof u))throw new TypeError("Cannot call a class as a function");return X(k(t=w.call(this)),"_serial",new S.VexSerialDeviceIQ),X(k(t),"lastSerialState",S.VexSerialDeviceConnectionStates.Disconnected),X(k(t),"onConnectedToInvalidPort",function(){var e=x.i18n.t("Incorrect WebSerial Port",{platform:x.i18n.t("IQ")});C.MODALCONTROL.showWebSerialPrompt(e,null,t.onControlButtonClick)}),X(k(t),"lastUserPortState",S.VexSerialDeviceConnectionStates.Disconnected),t.onSerialStateChange=t.onSerialStateChange.bind(k(t)),t._serial.on("connectionStateChange",t.onSerialStateChange),t.onSerialStateChangeUserPort=t.onSerialStateChangeUserPort.bind(k(t)),t._serial.on("connectionStateChangeUserPort",t.onSerialStateChangeUserPort),t.onConnectedToInvalidPort=t.onConnectedToInvalidPort.bind(k(t)),t._serial.on("connectedToInvalidPort",t.onConnectedToInvalidPort),t.onControlButtonClick=t.onControlButtonClick.bind(k(t)),t.onInterfaceDeviceInfoupdated=t.onInterfaceDeviceInfoupdated.bind(k(t)),t._serial.on("deviceInfoUpdated",t.onInterfaceDeviceInfoupdated),t._serial.on("receivedUserData",function(e){P.debug("print to terminal:",e),L.fireEvent("HWInterface.TerminalDataUpdate",e)}),t}return t=u,(e=[{key:"onSerialStateChange",value:function(e){var t;P.debug("onSerialStateChange - new state:",S.VexSerialDeviceConnectionStates[e]),this.lastSerialState!==e&&(this.lastSerialState=e,t=this.getConnectionState(),this.fireEvent("connectionStateChange",t),L.fireEvent("HWInterface.ConnectionStateChange",t),e===S.VexSerialDeviceConnectionStates.Connected?this.onBrainConnected():e===S.VexSerialDeviceConnectionStates.Disconnected&&this.onBrainDisconnected())}},{key:"onInterfaceDeviceInfoupdated",value:function(e){P.debug("onInterfaceDeviceInfoupdated");var t=this.getBrainInfo();L.fireEvent("HWInterface.BrainInfoUpdated",t)}},{key:"onControlButtonClick",value:(b=U(I().mark(function e(){return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.openConnection();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),function(){return b.apply(this,arguments)})},{key:"openConnection",value:(g=U(I().mark(function e(){var t;return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._serial.isSupported){e.next=3;break}return P.error("WebSerial is not supported on this system"),e.abrupt("return");case 3:return e.prev=3,P.debug("Attempting to open serial port connection"),e.next=7,this._serial.openConnection();case 7:e.next=13;break;case 9:e.prev=9,e.t0=e.catch(3),P.debug("Error attempting to open serial port connection: ",e.t0),e.t0 instanceof Error&&"NetworkError"===e.t0.name&&e.t0.message.includes("Failed to open serial port.")&&(t=x.i18n.t("Already Connected WebSerial Port",{platform:x.i18n.t("IQ")}),C.MODALCONTROL.alert(t));case 13:case"end":return e.stop()}},e,this,[[3,9]])})),function(){return g.apply(this,arguments)})},{key:"openEstablishedConnection",value:(y=U(I().mark(function e(){return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._serial.isSupported){e.next=3;break}return P.error("WebSerial is not supported on this system"),e.abrupt("return");case 3:return e.abrupt("return",this._serial.openEstablishedConnection());case 4:case"end":return e.stop()}},e,this)})),function(){return y.apply(this,arguments)})},{key:"openConnectionToBrain",value:function(e){throw new O.OperationNotSupportedError}},{key:"closeConnection",value:(v=U(I().mark(function e(){return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this._serial.isSupported){e.next=3;break}return P.error("WebSerial is not supported on this system"),e.abrupt("return");case 3:return e.next=5,this._serial.closeConnection();case 5:return e.abrupt("return",!0);case 6:case"end":return e.stop()}},e,this)})),function(){return v.apply(this,arguments)})},{key:"getConnectionState",value:function(){return this._serial.connectionState===S.VexSerialDeviceConnectionStates.Connected?m.BrainConnectionState.Connected:m.BrainConnectionState.Disconnected}},{key:"getBrainInfo",value:function(){var e=this._serial.getBrainInfo(),t=e.brainVersion?D.VexVersion.fromString(e.brainVersion.toInternalString()):D.VexVersion.fromString("0.0.0"),r="IQ"===e.deviceType,n=t&&"0.0.0.b0"!==t.toInternalString(),o=this.getCahcedIQ1ServerFirmwareVersion(),o=this.getUpdatedNeededFromServer(o,t),i="IQ2"===e.deviceType||"IQ2Controller"===e.deviceType,a="IQ2Controller"===e.deviceType,c=i?m.VexDeviceType.VEXIQ2:m.VexDeviceType.VEXIQ,t={serial:e.serial,version:t,versionFW:t,name:e.name,team:e.team,deviceType:c,connectionMethod:e.connectionType,brainConnected:e.isBrainConnected,needsFWUpdate:n?r?o:e.updateNeededBrain?m.UpdateNeededOptions.NeedsUpdate:m.UpdateNeededOptions.UpToDate:e.isDFUMode?m.UpdateNeededOptions.NeedsUpdate:m.UpdateNeededOptions.Unsure,canUpdate:i,battery:0,batteryLow:!1};return a&&(t.versionCTRL={atmel:e.atmelVersion,radio:e.radioVersion},t.needsCTRLUpdate=e.updateNeededController?m.UpdateNeededOptions.NeedsUpdate:m.UpdateNeededOptions.UpToDate),t}},{key:"getTargetBrainInfo",value:function(){throw new Error("Method not implemented.")}},{key:"setBrainName",value:(h=U(I().mark(function e(t){return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._serial.setBrainName(t);case 2:case"end":return e.stop()}},e,this)})),function(e){return h.apply(this,arguments)})},{key:"setTeamNumber",value:(d=U(I().mark(function e(t){return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._serial.setBrainTeamNumber(t);case 2:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"play",value:(f=U(I().mark(function e(t){return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._serial.play(t));case 1:case"end":return e.stop()}},e,this)})),function(e){return f.apply(this,arguments)})},{key:"stop",value:(p=U(I().mark(function e(){return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._serial.stop();case 2:return e.abrupt("return",!0);case 3:case"end":return e.stop()}},e,this)})),function(){return p.apply(this,arguments)})},{key:"downloadProgram",value:(l=U(I().mark(function e(t,r,n,o,i){var a,c,s;return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.info("downloadProgram",t,r,n),a="Blocks"===V.appState.getAppState().mode,c="cpp"===n,s=a?S.VEXcodeIcons.VEXcodeBlocks:c?S.VEXcodeIcons.VEXcodeCPP:S.VEXcodeIcons.VEXcodePython,s={slot:t,name:r,description:"",icon:s,ide:a?"Blocks":c?"C++":"Python",controller1:null,ports:[],triports:[],language:n},e.abrupt("return",this._serial.downloadProgram(o,s,function(e){var t=e.progress,e=e.state;i({progress:t,step:e})}));case 7:case"end":return e.stop()}},e,this)})),function(e,t,r,n,o){return l.apply(this,arguments)})},{key:"runInitialCheck",value:(s=U(I().mark(function e(t){return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",null);case 1:case"end":return e.stop()}},e)})),function(e){return s.apply(this,arguments)})},{key:"forcePythonVMDownload",value:(c=U(I().mark(function e(t){var r;return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(e){t&&t({progress:e.progress,step:W.DownloadState.DownloadingVM})},e.next=3,this._serial.checkAndInstallPythonVm(0,0,r,!0);case 3:return r=e.sent,e.abrupt("return",0===(null==r?void 0:r.err));case 5:case"end":return e.stop()}},e,this)})),function(e){return c.apply(this,arguments)})},{key:"canUpdateFirmware",value:function(){return this.targetIsIQ2}},{key:"updateFirmware",value:(a=U(I().mark(function e(u){var n,o,i,t,r,a,c,s;return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.targetIsIQ2){e.next=2;break}throw new O.OperationNotSupportedError;case 2:return e.prev=2,P.debug("starting brain firmware update..."),n=new _.DispatcherEvent,o=new _.DispatcherEvent,i=null,t=function(e){i?(i(e),i=null):(P.warn("should not be here if the resolver was not set"),o.fire({isFirstConnect:!1,isDfu:!1}))},C.MODALCONTROL.showWebBrainUpdateProgress(n,o,t),t=function(e,t,r){P.debug("progressHandler:",t,S.VEXBrainUpdateStates[e],r),n.fire({state:e,percent:t,msg:r})},r=function(r,n){return new Promise(function(e,t){i=e,o.fire({isFirstConnect:r,isDfu:n})})},P.debug("calling brain firmware update..."),e.next=14,Object(T.waitms)(5);case 14:return e.next=16,this._serial.updateFirmware(t,r);case 16:return P.debug("brain firmware update done"),e.abrupt("return",!0);case 20:return e.prev=20,e.t0=e.catch(2),P.error(e.t0),C.MODALCONTROL.close(),a="WebSerial Update Failed - unknown error",c="WebSerial Update Failed - retry message",e.t0 instanceof E.WebSerialUnsupportedError?a="WebSerial Update Failed - webserial not supported":e.t0 instanceof E.NoBrainConnectedError?a="WebSerial Update Failed - no device":e.t0 instanceof E.OperationNotSupportedError?a="WebSerial Update Failed - not supported":e.t0 instanceof E.ErrorUpdatingBrainGolden?a="WebSerial Update Failed - recovery update failed":e.t0 instanceof E.ErrorUpdatingBrainBoot?a="WebSerial Update Failed - main update failed":e.t0 instanceof E.ErrorUpdatingBrainAssets&&(a="WebSerial Update Failed - asset update failed"),s=x.i18n.t(N.currentTargetName),C.MODALCONTROL.showWebSerialUpdateError(x.i18n.t(a,{platform:s}),x.i18n.t(c,{platform:s}),"https://kb.vex.com/hc/en-us/articles/5161655264020-Troubleshooting-Connecting-to-Web-based-VEXcode-IQ"),e.abrupt("return",!1);case 30:case"end":return e.stop()}},e,this,[[2,20]])})),function(e){return a.apply(this,arguments)})},{key:"updateControllerFirmware",value:(i=U(I().mark(function e(l){var t,n,o,i,a,r,c,s,u=arguments;return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=1<u.length&&void 0!==u[1]&&u[1],t=2<u.length&&void 0!==u[2]&&u[2],P.info("updateControllerFirmware"),n=null,e.prev=4,P.debug("starting controller firmware update..."),o=new _.DispatcherEvent,i=new _.DispatcherEvent,a=null,r=function(e){a?(a(e),a=null):(P.warn("should not be here if the resolver was not set"),i.fire({isFirstConnect:!1,isDfu:!1}))},C.MODALCONTROL.showWebControllerUpdateProgress(o,i,r),r=function(e,t,r){P.debug("progressHandler:",t,S.VEXControllerUpdateStates[e],r),o.fire({state:e,percent:t,msg:r}),n=e},c=function(r,n){return new Promise(function(e,t){a=e,i.fire({isFirstConnect:r,isDfu:n})})},e.next=15,this._serial.controllerUpdate(r,c,s,t);case 15:return e.abrupt("return",!0);case 18:return e.prev=18,e.t0=e.catch(4),P.error(e.t0),C.MODALCONTROL.close(),r="WebSerial Update Failed - unknown error",c="WebSerial Update Failed - retry message",e.t0 instanceof E.WebSerialUnsupportedError?r="WebSerial Update Failed - webserial not supported":e.t0 instanceof E.NoControllerConnectedError?r="WebSerial Update Failed - no device":e.t0 instanceof E.OperationNotSupportedError?r="WebSerial Update Failed - not supported":e.t0 instanceof E.UpdateCanceled?r="WebSerial Update Failed - user canceled reconnect":n===S.VEXControllerUpdateStates.UpdatingRadio?r="WebSerial Update Failed - radio update failed":n===S.VEXControllerUpdateStates.UpdatingAtmel&&(r="WebSerial Update Failed - atmel update failed"),s=x.i18n.t(N.currentTargetName),C.MODALCONTROL.showWebSerialUpdateError(x.i18n.t(r,{platform:s}),x.i18n.t(c,{platform:s}),"https://kb.vex.com/hc/en-us/articles/5161655264020-Troubleshooting-Connecting-to-Web-based-VEXcode-IQ"),e.abrupt("return",!1);case 28:case"end":return e.stop()}},e,this,[[4,18]])})),function(e){return i.apply(this,arguments)})},{key:"supportsUserPort",get:function(){return!0}},{key:"requiresUserPortConnectionProcess",get:function(){return!0}},{key:"openConnectionUserPort",value:(o=U(I().mark(function e(){return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this._serial.openConnectionUserPort());case 1:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"closeConnectionUserPort",value:(n=U(I().mark(function e(){return I().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._serial.closeConnectionUserPort();case 2:return e.abrupt("return",!0);case 3:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"getConnectionStateUserPort",value:function(){var e=this._serial.connectionStateUserPort;return this.isBrainConnected()&&e===S.VexSerialDeviceConnectionStates.Connected?m.BrainConnectionState.Connected:m.BrainConnectionState.Disconnected}},{key:"sendDataUserPort",value:function(e){this._serial.sendDataUserPort(e)}},{key:"onSerialStateChangeUserPort",value:function(e){P.debug("onSerialStateChange - new state:",S.VexSerialDeviceConnectionStates[e]),this.lastUserPortState!==e&&(this.lastUserPortState=e,e=this.getConnectionStateUserPort(),this.fireEvent("connectionStateChange",e),L.fireEvent("HWInterface.ConnectionStateChangeUserPort",e))}},{key:"getLowLevelLogger",value:function(){return null}}])&&B(t.prototype,e),r&&B(t,r),Object.defineProperty(t,"prototype",{writable:!1}),u}(n.IQInterface))}}]);