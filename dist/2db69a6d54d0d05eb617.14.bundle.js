(window.webpackJsonpwebapp=window.webpackJsonpwebapp||[]).push([[14],{"./src/FileSys/FileSystem/FileSystemAccess.ts":function(r,e,t){"use strict";t.r(e),t.d(e,"FileSystemAccess",function(){return i});var e=t("./node_modules/@rm-vca/logger/dist/index.js"),n=t("./src/FileSys/FileSystem/FileSystemBase.ts"),x=t("./src/FileSys/FileSystem/FileSystemErrors.ts"),F=t("./src/widget/Modal.tsx"),E=t("./src/i18n/i18n.ts");function O(e){return(O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function k(){k=function(){return a};var a={},s=Object.prototype,c=s.hasOwnProperty,u=Object.defineProperty||function(e,t,r){e[t]=r.value},e="function"==typeof Symbol?Symbol:{},n=e.iterator||"@@iterator",f=e.asyncIterator||"@@asyncIterator",d=e.toStringTag||"@@toStringTag";function r(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{r({},"")}catch(e){r=function(e,t,r){return e[t]=r}}function p(e,t,r,n){var o,i,a,s,t=t&&t.prototype instanceof m?t:m,t=Object.create(t.prototype),n=new x(n||[]);return u(t,"_invoke",{value:(o=e,i=r,a=n,s="suspendedStart",function(e,t){if("executing"===s)throw new Error("Generator is already running");if("completed"===s){if("throw"===e)throw t;return E()}for(a.method=e,a.arg=t;;){var r=a.delegate;if(r){r=function e(t,r){var n=r.method,o=t.iterator[n];if(void 0===o)return r.delegate=null,"throw"===n&&t.iterator.return&&(r.method="return",r.arg=void 0,e(t,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),l;n=h(o,t.iterator,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,l;o=n.arg;return o?o.done?(r[t.resultName]=o.value,r.next=t.nextLoc,"return"!==r.method&&(r.method="next",r.arg=void 0),r.delegate=null,l):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,l)}(r,a);if(r){if(r===l)continue;return r}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if("suspendedStart"===s)throw s="completed",a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);s="executing";r=h(o,i,a);if("normal"===r.type){if(s=a.done?"completed":"suspendedYield",r.arg===l)continue;return{value:r.arg,done:a.done}}"throw"===r.type&&(s="completed",a.method="throw",a.arg=r.arg)}})}),t}function h(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}a.wrap=p;var l={};function m(){}function v(){}function t(){}var e={},o=(r(e,n,function(){return this}),Object.getPrototypeOf),o=o&&o(o(F([]))),i=(o&&o!==s&&c.call(o,n)&&(e=o),t.prototype=m.prototype=Object.create(e));function y(e){["next","throw","return"].forEach(function(t){r(e,t,function(e){return this._invoke(t,e)})})}function w(a,s){var t;u(this,"_invoke",{value:function(r,n){function e(){return new s(function(e,t){!function t(e,r,n,o){var i,e=h(a[e],a,r);if("throw"!==e.type)return(r=(i=e.arg).value)&&"object"==O(r)&&c.call(r,"__await")?s.resolve(r.__await).then(function(e){t("next",e,n,o)},function(e){t("throw",e,n,o)}):s.resolve(r).then(function(e){i.value=e,n(i)},function(e){return t("throw",e,n,o)});o(e.arg)}(r,n,e,t)})}return t=t?t.then(e,e):e()}})}function g(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function b(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function x(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(g,this),this.reset(!0)}function F(t){if(t){var r,e=t[n];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return r=-1,(e=function e(){for(;++r<t.length;)if(c.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e}).next=e}return{next:E}}function E(){return{value:void 0,done:!0}}return u(i,"constructor",{value:v.prototype=t,configurable:!0}),u(t,"constructor",{value:v,configurable:!0}),v.displayName=r(t,d,"GeneratorFunction"),a.isGeneratorFunction=function(e){e="function"==typeof e&&e.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},a.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,t):(e.__proto__=t,r(e,d,"GeneratorFunction")),e.prototype=Object.create(i),e},a.awrap=function(e){return{__await:e}},y(w.prototype),r(w.prototype,f,function(){return this}),a.AsyncIterator=w,a.async=function(e,t,r,n,o){void 0===o&&(o=Promise);var i=new w(p(e,t,r,n),o);return a.isGeneratorFunction(t)?i:i.next().then(function(e){return e.done?e.value:i.next()})},y(i),r(i,d,"Generator"),r(i,n,function(){return this}),r(i,"toString",function(){return"[object Generator]"}),a.keys=function(e){var t,r=Object(e),n=[];for(t in r)n.push(t);return n.reverse(),function e(){for(;n.length;){var t=n.pop();if(t in r)return e.value=t,e.done=!1,e}return e.done=!0,e}},a.values=F,x.prototype={constructor:x,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(b),!e)for(var t in this)"t"===t.charAt(0)&&c.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(r){if(this.done)throw r;var n=this;function e(e,t){return i.type="throw",i.arg=r,n.next=e,t&&(n.method="next",n.arg=void 0),!!t}for(var t=this.tryEntries.length-1;0<=t;--t){var o=this.tryEntries[t],i=o.completion;if("root"===o.tryLoc)return e("end");if(o.tryLoc<=this.prev){var a=c.call(o,"catchLoc"),s=c.call(o,"finallyLoc");if(a&&s){if(this.prev<o.catchLoc)return e(o.catchLoc,!0);if(this.prev<o.finallyLoc)return e(o.finallyLoc)}else if(a){if(this.prev<o.catchLoc)return e(o.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return e(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;0<=r;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&c.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var o=n;break}}var i=(o=o&&("break"===e||"continue"===e)&&o.tryLoc<=t&&t<=o.finallyLoc?null:o)?o.completion:{};return i.type=e,i.arg=t,o?(this.method="next",this.next=o.finallyLoc,l):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),b(r),l}},catch:function(e){for(var t=this.tryEntries.length-1;0<=t;--t){var r,n,o=this.tryEntries[t];if(o.tryLoc===e)return"throw"===(r=o.completion).type&&(n=r.arg,b(o)),n}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:F(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},a}function c(e,t,r,n,o,i,a){try{var s=e[i](a),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,o)}function R(s){return function(){var e=this,a=arguments;return new Promise(function(t,r){var n=s.apply(e,a);function o(e){c(n,t,r,o,i,"next",e)}function i(e){c(n,t,r,o,i,"throw",e)}o(void 0)})}}function _(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,function(e){e=function(e,t){if("object"!==O(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0===r)return("string"===t?String:Number)(e);r=r.call(e,t||"default");if("object"!==O(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}(e,"string");return"symbol"===O(e)?e:String(e)}(n.key),n)}}function A(e,t){return(A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function L(r){var n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var e,t=o(r),t=(e=n?(e=o(this).constructor,Reflect.construct(t,arguments,e)):t.apply(this,arguments),this);if(e&&("object"===O(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}}function o(e){return(o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var P=e.getLogger("FileSystemAccess"),S=(P.setLevel(P.levels.WARN),P.setHistoryLogger("FileSystem"),null),i=function(e){var t=u;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&A(t,e);var r,n,o,i,a,s,c,l,f,d,p,h,m,v,y,w,g,b=L(u);function u(){var e=this,t=u;if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");return b.apply(this,arguments)}return t=u,(e=[{key:"canLoadFromURI",get:function(){return!1}},{key:"canLoadAnyFile",get:function(){return!1}},{key:"supportsRename",get:function(){return!0}},{key:"supportsStringRename",get:function(){return!1}},{key:"saveAfterRename",get:function(){return!0}},{key:"savesToFileReference",get:function(){return!0}},{key:"readFile",value:(g=R(k().mark(function e(t){var n,r;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.info("readFile:",t),r=t.pathData,e.next=4,r.getFile();case 4:if(n=e.sent){e.next=8;break}throw P.error("unable to read file. no path data in the file ref",t),new x.ErrorFSFileRefInvalidData;case 8:if(n.text)return e.next=11,n.text();e.next=14;break;case 11:return r=e.sent,P.debug("read content:",r),e.abrupt("return",r);case 14:return e.abrupt("return",new Promise(function(t,r){var e=new FileReader;e.onload=function(e){e=e.target.result;P.debug("readFile result:",e),t(e)},e.onerror=function(e){P.debug("readFile - error:",e),r(new x.ErrorFS)},e.onabort=function(e){P.debug("readFile - abort:",e),r(new x.ErrorFS)},e.readAsText(n)}));case 15:case"end":return e.stop()}},e)})),function(e){return g.apply(this,arguments)})},{key:"readFileAsData",value:(w=R(k().mark(function e(t){var r,n;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.info("readFile:",t),r=t.pathData,e.next=4,r.getFile();case 4:if(n=e.sent){e.next=8;break}throw P.error("unable to read file. no path data in the file ref",t),new x.ErrorFSFileRefInvalidData;case 8:if(n.text)return e.next=11,n.text();e.next=12;break;case 11:return e.abrupt("return",e.sent);case 12:return e.abrupt("return",new Promise(function(t,r){var e=new FileReader;e.onload=function(e){e=e.target.result;P.debug("readFile result:",e),t(e)},e.onerror=function(e){P.debug("readFile - error:",e),r(new x.ErrorFS)},e.onabort=function(e){P.debug("readFile - abort:",e),r(new x.ErrorFS)},e.readAsDataURL(n)}));case 13:case"end":return e.stop()}},e)})),function(e){return w.apply(this,arguments)})},{key:"readFileAsBuffer",value:(y=R(k().mark(function e(t){var r,n;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.info("readFileAsBuffer:",t),r=t.pathData,e.next=4,r.getFile();case 4:if(n=e.sent){e.next=8;break}throw P.error("unable to read file. no path data in the file ref",t),new x.ErrorFSFileRefInvalidData;case 8:if(n.arrayBuffer)return e.next=11,n.arrayBuffer();e.next=12;break;case 11:return e.abrupt("return",e.sent);case 12:return e.abrupt("return",new Promise(function(t,r){var e=new FileReader;e.onload=function(e){e=e.target.result;P.debug("readFile result:",e),t(e)},e.onerror=function(e){P.debug("readFile - error:",e),r(new x.ErrorFS)},e.onabort=function(e){P.debug("readFile - abort:",e),r(new x.ErrorFS)},e.readAsArrayBuffer(n)}));case 13:case"end":return e.stop()}},e)})),function(e){return y.apply(this,arguments)})},{key:"writeFile",value:(v=R(k().mark(function e(t,r){var n,o,i;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(P.info("writeFile:",t,r),n=null==t?void 0:t.pathData){e.next=5;break}throw P.error("unable to write file. no path data in the file ref",t),new x.ErrorFSFileRefInvalidData;case 5:return o=new TextEncoder,o=o.encode(r),e.next=9,n.createWritable();case 9:return i=e.sent,e.next=12,i.write({type:"truncate",size:0});case 12:return e.next=14,i.write(o);case 14:return e.next=16,i.close();case 16:case"end":return e.stop()}},e)})),function(e,t){return v.apply(this,arguments)})},{key:"writeFileWithBuffer",value:(m=R(k().mark(function e(t,r){var n,o,i;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(P.info("writeFile:",t,r),n=null==t?void 0:t.pathData){e.next=5;break}throw P.error("unable to write file. no path data in the file ref",t),new x.ErrorFSFileRefInvalidData;case 5:return o=new Uint8Array(r),e.next=8,n.createWritable();case 8:return i=e.sent,e.next=11,i.write({type:"truncate",size:0});case 11:return e.next=13,i.write(o);case 13:return e.next=15,i.close();case 15:case"end":return e.stop()}},e)})),function(e,t){return m.apply(this,arguments)})},{key:"renameFile",value:(h=R(k().mark(function e(t,r){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new x.ErrorFSOperationNotSupported;case 1:case"end":return e.stop()}},e)})),function(e,t){return h.apply(this,arguments)})},{key:"checkFileExists",value:(p=R(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw new x.ErrorFSOperationNotSupported("File exists check operation is not supported on the current platform");case 1:case"end":return e.stop()}},e)})),function(e){return p.apply(this,arguments)})},{key:"requestWritePermission",value:(d=R(k().mark(function e(t){var r,n,o;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.hasWritePermission&&t.hasFolderWritePermissions)return P.warn("why was requestWritePermission called on a file that already has write permission?"),e.abrupt("return",!0);e.next=3;break;case 3:return r=t.pathData,n={mode:"readwrite",writable:!0},t.hasFolderWritePermissions&&!t.hasWritePermission&&(P.info("Resetting folder permission to false to trigger a recheck..."),t.hasFolderWritePermissions=!1),e.next=8,r.queryPermission(n);case 8:if(e.t0=e.sent,"granted"===e.t0)return t.hasWritePermission=!0,e.abrupt("return",!0);e.next=12;break;case 12:return e.next=15,r.requestPermission(n);case 15:if(e.t1=e.sent,"granted"===e.t1)return t.hasWritePermission=!0,e.next=20,this.verifyFolderPermission(r,!0);e.next=23;break;case 20:return o=e.sent,t.hasFolderWritePermissions=o,e.abrupt("return",o);case 23:return e.next=25,new Promise(function(e,t){F.MODALCONTROL.showCustomPrompt(E.i18n.t("file system access api save permission denied confirmation"),E.i18n.t("Continue Without Autosave"),E.i18n.t("Try Again"),e,!0)});case 25:if(e.sent)return e.abrupt("return",!1);e.next=28;break;case 28:e.next=12;break;case 30:case"end":return e.stop()}},e,this)})),function(e){return d.apply(this,arguments)})},{key:"selectCustomFileToOpen",value:(f=R(k().mark(function r(e,t,n){var o,i,a,s,c,u,l;return k().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return P.info("_____ User attempting to open a file _____"),P.info("selectCustomFileToOpen",e,t,n),c={startIn:(null==t?void 0:t.pathData)||S||"documents",types:[]},"Project"===e?(o=n.map(function(e){return"."+e}),c.types.push({description:"VEXcode Project",accept:{"text/plain":o}})):"MazeData"===e?c.types.push({description:"VR maze data",accept:{"text/json":[".vrmaze"]}}):"VRImage"===e&&c.types.push({description:"PNG image",accept:{"image/png":[".png"],"image/jpeg":[".jpeg",".jpg"]}}),r.prev=4,r.next=7,window.showOpenFilePicker(c);case 7:return o=r.sent,i=o[0],r.next=11,this.verifyFilePermissions(i,"Project"===e);case 11:return a=r.sent,r.next=14,this.verifyFolderPermission(i,a);case 14:return s=r.sent,r.next=17,i.getFile();case 17:return c=r.sent,u=c.name,l=u.substring(0,u.lastIndexOf(".")),P.debug("name of the file the user selected:",u),l={name:l,pathData:i,fileExtension:u.substring(u.lastIndexOf(".")+1),hasWritePermission:a,hasFolderWritePermissions:s},S=i,P.info("File has been successfully opened and created a iFileReference: ",l),r.abrupt("return",l);case 27:if(r.prev=27,r.t0=r.catch(4),r.t0 instanceof DOMException&&"AbortError"===r.t0.name&&r.t0.message.includes("The user aborted a request."))throw P.info("USER CANCELED: No file has been selected. Modal to inform user displayed."),P.debug("Error Information: ",null===r.t0||void 0===r.t0?void 0:r.t0.name,null===r.t0||void 0===r.t0?void 0:r.t0.message),F.MODALCONTROL.alert(E.i18n.t("Canceled open")),new x.ErrorFSUserCanceledOperation;r.next=36;break;case 36:if(r.t0 instanceof DOMException&&"AbortError"===r.t0.name&&r.t0.message.includes("Failed to create or truncate file."))return P.info("ERROR_OPEN_01: User does not have read/write access to desired file they are trying to open. Modal to inform user displayed."),P.debug("Error Information: ",null===r.t0||void 0===r.t0?void 0:r.t0.name,null===r.t0||void 0===r.t0?void 0:r.t0.message),r.next=41,new Promise(function(e){F.MODALCONTROL.showNoWriteAccessPrompt(E.i18n.t("No write access open"),e,E.i18n.t("Save to New Location"),"ERROR_OPEN_01")});r.next=44;break;case 41:throw new x.ErrorFSUserCanceledOperation;case 44:if(r.t0 instanceof x.ErrorFSAccessBlocked||r.t0 instanceof DOMException&&"NotAllowedError"===r.t0.name)return P.info("ERROR_OPEN_02: User does not have permission to edit files"),P.debug("Error Information: ",null===r.t0||void 0===r.t0?void 0:r.t0.name,null===r.t0||void 0===r.t0?void 0:r.t0.message),r.next=49,new Promise(function(e){var t=r.t0 instanceof DOMException,t=t&&r.t0.message.includes("The request is not allowed by the user agent or the platform in the current context.")?"The request is not allowed by the user agent or the platform in the current context.":t?r.t0.message:void 0;F.MODALCONTROL.showFileSystemBlockedPrompt(e,"ERROR_OPEN_02",t)});r.next=54;break;case 49:if(r.t0 instanceof x.ErrorFSAccessBlocked)throw r.t0;r.next=53;break;case 53:throw new x.ErrorFSAccessBlocked;case 54:throw P.info("ERROR_OPEN_FF: An unknown error has occurred during file selection. Modal to inform user displayed."),P.debug("Error Information: ",null===r.t0||void 0===r.t0?void 0:r.t0.name,null===r.t0||void 0===r.t0?void 0:r.t0.message),F.MODALCONTROL.showUnhandledErrorPrompt(E.i18n.t("Unhandled open error"),"ERROR_OPEN_FF",null===r.t0||void 0===r.t0?void 0:r.t0.name,null===r.t0||void 0===r.t0?void 0:r.t0.message),r.t0;case 58:case"end":return r.stop()}},r,this,[[4,27]])})),function(e,t,r){return f.apply(this,arguments)})},{key:"selectCustomFileToSave",value:(l=R(k().mark(function r(e,t){var n,f,o,d,i,a,s,p,c,u,l,h;return k().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(P.info("_____ User attempting to save a file _____"),P.info("selectCustomFileToSave",e,t),n=t.fileExtension){r.next=6;break}throw P.error("ERROR: Unable to read file. No extension in the file ref",t),new x.ErrorFSFileRefInvalidData;case 6:if(f=t.name){r.next=10;break}throw P.error("ERROR: Unable to read file. No name in the file ref",t),new x.ErrorFSFileRefInvalidData;case 10:return o=n,"MazeData"===e?o="vrmaze":"VRImage"===e&&(o="png"),a="".concat(f,".").concat(o),a={startIn:(null==t?void 0:t.pathData)||S||"documents",types:[],suggestedName:a,excludeAcceptAllOption:!0},"Project"===e?a.types.push({description:"VEXcode Project",accept:{"text/plain":".".concat(o)}}):"MazeData"===e?a.types.push({description:"VR maze data",accept:{"text/json":".".concat(o)}}):"VRImage"===e&&a.types.push({description:"PNG image",accept:{"image/png":".".concat(o)}}),r.prev=15,d=function(e){var t=e.lastIndexOf(".");return-1===t?"":e.substring(t+1)},r.next=19,window.showSaveFilePicker(a);case 19:return i=r.sent,r.next=22,i.getFile();case 22:if(a=r.sent,s=a.name,p=s.substring(0,s.lastIndexOf(".")),c=d(s),l=u=null,c===o)return r.next=31,this.verifyFilePermissions(i,"Project"===e);r.next=37;break;case 31:return u=r.sent,r.next=34,this.verifyFolderPermission(i,u);case 34:l=r.sent,r.next=39;break;case 37:l=u=!0;case 39:return P.debug("name of the file that is being saved",s),h={name:p,pathData:i,fileExtension:c,hasWritePermission:u,hasFolderWritePermissions:l},S=i,r.abrupt("return",h);case 45:if(r.prev=45,r.t0=r.catch(15),r.t0 instanceof DOMException&&"AbortError"===r.t0.name&&r.t0.message.includes("The user aborted a request."))throw P.info("USER CANCELED: No save location has been selected. Modal to inform user displayed."),P.debug("Error Information: ",null===r.t0||void 0===r.t0?void 0:r.t0.name,null===r.t0||void 0===r.t0?void 0:r.t0.message),F.MODALCONTROL.alert(E.i18n.t("Canceled save")),new x.ErrorFSUserCanceledOperation;r.next=54;break;case 54:if(r.t0 instanceof DOMException&&"AbortError"===r.t0.name&&r.t0.message.includes("Failed to create or truncate file"))return P.info("ERROR_SAVE_01: User does not have read/write access to desired folder they are trying to save to. Modal to inform user displayed."),P.debug("Error Information: ",null===r.t0||void 0===r.t0?void 0:r.t0.name,null===r.t0||void 0===r.t0?void 0:r.t0.message),r.next=59,new Promise(function(e){F.MODALCONTROL.showNoWriteAccessPrompt(E.i18n.t("No write access save"),e,E.i18n.t("Save to New Location"),"ERROR_SAVE_01")});r.next=62;break;case 59:throw new x.ErrorFSWriteError;case 62:if(r.t0 instanceof x.ErrorFSAccessDenied||r.t0 instanceof DOMException&&"NotAllowedError"===r.t0.name)return P.warn("ERROR_SAVE_02: User does not have permission to edit files"),P.debug("Error Information: ",null===r.t0||void 0===r.t0?void 0:r.t0.name,null===r.t0||void 0===r.t0?void 0:r.t0.message),r.next=67,new Promise(function(e){var t=r.t0 instanceof DOMException,t=t&&r.t0.message.includes("The request is not allowed by the user agent or the platform in the current context.")?"The request is not allowed by the user agent or the platform in the current context.":t?r.t0.message:void 0;F.MODALCONTROL.showFileSystemBlockedPrompt(e,"ERROR_SAVE_02",t)});r.next=68;break;case 67:throw new x.ErrorFSAccessDenied(null===r.t0||void 0===r.t0?void 0:r.t0.message);case 68:throw P.info("ERROR_SAVE_FF: An unknown error has occurred while selecting save location. Modal to inform user displayed."),P.debug("Error Information: ",null===r.t0||void 0===r.t0?void 0:r.t0.name,null===r.t0||void 0===r.t0?void 0:r.t0.message),F.MODALCONTROL.showUnhandledErrorPrompt(E.i18n.t("Unhandled save error"),"ERROR_SAVE_FF",null===r.t0||void 0===r.t0?void 0:r.t0.name,null===r.t0||void 0===r.t0?void 0:r.t0.message),r.t0;case 72:case"end":return r.stop()}},r,this,[[15,45]])})),function(e,t){return l.apply(this,arguments)})},{key:"selectFileToOpen",value:(c=R(k().mark(function e(t,r){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.info("selectFileToOpen",t,r),r=r||this.getOpenProjectExtensions(),e.abrupt("return",this.selectCustomFileToOpen("Project",t,r));case 3:case"end":return e.stop()}},e,this)})),function(e,t){return c.apply(this,arguments)})},{key:"selectFileToSave",value:(s=R(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.info("selectFileToSave",t),e.abrupt("return",this.selectCustomFileToSave("Project",t));case 2:case"end":return e.stop()}},e,this)})),function(e){return s.apply(this,arguments)})},{key:"cleanupFileReferenceAfterRead",value:function(e){return P.info("cleanupFileReferenceAfterRead",e),e}},{key:"cleanupFileReferenceAfterWrite",value:function(e){return P.info("cleanupFileReferenceAfterWrite",e),e}},{key:"createFileReferenceFromURI",value:(a=R(k().mark(function e(t){return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:throw P.info("createFileReferenceFromURI",t),new x.ErrorFSOperationNotSupported;case 2:case"end":return e.stop()}},e)})),function(e){return a.apply(this,arguments)})},{key:"verifyFolderPermission",value:(i=R(k().mark(function e(t,r){var n;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(P.debug("verifyFolderPermission",r),r)return e.prev=2,e.next=5,t.createWritable({keepExistingData:!0});e.next=21;break;case 5:return n=e.sent,P.debug("confirmed file writable via writable stream creation"),e.next=9,n.close();case 9:return e.abrupt("return",!0);case 12:if(e.prev=12,e.t0=e.catch(2),e.t0 instanceof DOMException&&"NoModificationAllowedError"===e.t0.name&&"An attempt was made to write to a file or directory which could not be modified due to the state of the underlying filesystem."===e.t0.message)return P.error("unable to write to file due to folder permissions",e.t0,null===e.t0||void 0===e.t0?void 0:e.t0.name,null===e.t0||void 0===e.t0?void 0:e.t0.message),e.abrupt("return",!1);e.next=17;break;case 17:return P.error("Failed to write to file while checking for file permission:",e.t0,null===e.t0||void 0===e.t0?void 0:e.t0.name,null===e.t0||void 0===e.t0?void 0:e.t0.message),e.abrupt("return",!1);case 19:e.next=23;break;case 21:return P.info("The file has not been granted write access by the user"),e.abrupt("return",!0);case 23:case"end":return e.stop()}},e,null,[[2,12]])})),function(e,t){return i.apply(this,arguments)})},{key:"requestBrowserFilePermission",value:(o=R(k().mark(function e(t,r){var n,o,i;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.info("requestBrowserFilePermission",r),n=Date.now(),e.next=4,t.requestPermission(r);case 4:if(o=e.sent,i=Date.now()-n,"granted"===o)return P.debug("granted file permission"),e.abrupt("return",!0);e.next=11;break;case 11:if(i<250)throw P.debug("permission is not granted and responded in",i,"ms"),new x.ErrorFSAccessBlocked("suspected file editing blocked");e.next=14;break;case 14:return P.debug("permission is not granted"),e.abrupt("return",!1);case 16:case"end":return e.stop()}},e)})),function(e,t){return o.apply(this,arguments)})},{key:"verifyFilePermissions",value:(n=R(k().mark(function e(t,r){var n;return k().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return P.info("verifyFilePermissions"),n={},r&&(n.writable=!0,n.mode="readwrite"),e.next=5,t.queryPermission(n);case 5:if(e.t0=e.sent,"granted"===e.t0)return P.debug("already has file permission"),e.abrupt("return",!0);e.next=9;break;case 9:return e.next=12,this.requestBrowserFilePermission(t,n);case 12:if(e.sent)return P.debug("granted file permission after being requested"),e.abrupt("return",!0);e.next=15;break;case 15:return e.next=17,new Promise(function(e,t){F.MODALCONTROL.showCustomPrompt(E.i18n.t("file system access api autosave permission denied confirmation"),E.i18n.t("Continue Without Autosave"),E.i18n.t("Try Again"),e,!0)});case 17:if(e.sent)return e.abrupt("return",!1);e.next=20;break;case 20:e.next=9;break;case 22:case"end":return e.stop()}},e,this)})),function(e,t){return n.apply(this,arguments)})}])&&_(t.prototype,e),r&&_(t,r),Object.defineProperty(t,"prototype",{writable:!1}),u}(n.FileSystemBase)}}]);